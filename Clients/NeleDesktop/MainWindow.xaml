<Window x:Class="NeleDesktop.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
        xmlns:vm="clr-namespace:NeleDesktop.ViewModels"
        xmlns:models="clr-namespace:NeleDesktop.Models"
        xmlns:converters="clr-namespace:NeleDesktop.Converters"
        Title="Nele Chat" Width="760" Height="620" MinWidth="{Binding WindowMinWidth}" MinHeight="520"
        WindowStyle="None"
        ResizeMode="CanResize"
        Background="{DynamicResource WindowBackgroundBrush}"
        FontFamily="Segoe UI Variable"
        Loaded="Window_Loaded"
        PreviewKeyDown="Window_PreviewKeyDown"
        SourceInitialized="Window_SourceInitialized"
        Closing="Window_Closing"
        StateChanged="Window_StateChanged"
        LocationChanged="Window_LocationChanged"
        SizeChanged="Window_SizeChanged">
    <shell:WindowChrome.WindowChrome>
        <shell:WindowChrome CaptionHeight="44" CornerRadius="12" GlassFrameThickness="0" ResizeBorderThickness="6" />
    </shell:WindowChrome.WindowChrome>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="44" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0"
                Background="{DynamicResource TitleBarBackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,0,0,1"
                MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
            <Grid Margin="12,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Style="{StaticResource IconButtonStyle}"
                            Command="{Binding ToggleSidebarCommand}"
                            ToolTip="Toggle conversations"
                            VerticalAlignment="Center"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True">
                        <TextBlock FontFamily="Segoe MDL2 Assets" FontSize="16" Text="&#xE700;" />
                    </Button>
                    <TextBlock Text="Nele AI" FontSize="14" FontWeight="SemiBold" Margin="6,0,0,0" VerticalAlignment="Center" />
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Style="{StaticResource IconButtonStyle}"
                            Command="{Binding ToggleThemeCommand}"
                            ToolTip="Toggle theme"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True">
                        <TextBlock FontFamily="Segoe MDL2 Assets" FontSize="16">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="&#xE708;" />
                                    <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsDarkMode}" Value="False">
                                            <Setter Property="Text" Value="&#xE706;" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsDarkMode}" Value="True">
                                            <Setter Property="Foreground" Value="{DynamicResource AccentBrush}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Button>
                    <Grid Margin="6,0,0,0">
                        <Button Style="{StaticResource IconButtonStyle}"
                                Click="OpenSettings_Click"
                                ToolTip="Settings"
                                shell:WindowChrome.IsHitTestVisibleInChrome="True">
                            <TextBlock FontFamily="Segoe MDL2 Assets" FontSize="16" Text="&#xE713;" />
                        </Button>
                        <Border Width="14"
                                Height="14"
                                CornerRadius="7"
                                Background="{DynamicResource AttentionBrush}"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                Margin="0,-2,-2,0"
                                IsHitTestVisible="False"
                                Visibility="{Binding IsApiKeyMissing, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="!" FontSize="10" FontWeight="Bold" Foreground="#FFFFFF" HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </Grid>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0,0,0">
                    <Button Style="{StaticResource TitleBarButtonStyle}" Click="Minimize_Click" shell:WindowChrome.IsHitTestVisibleInChrome="True">
                        <TextBlock FontFamily="Segoe MDL2 Assets" FontSize="12" Text="&#xE921;" />
                    </Button>
                    <Button Style="{StaticResource TitleBarButtonStyle}" Click="Maximize_Click" Margin="4,0,0,0" shell:WindowChrome.IsHitTestVisibleInChrome="True">
                        <TextBlock x:Name="MaximizeIcon" FontFamily="Segoe MDL2 Assets" FontSize="12" Text="&#xE922;" />
                    </Button>
                    <Button Style="{StaticResource TitleBarCloseButtonStyle}" Click="Close_Click" Margin="4,0,0,0" shell:WindowChrome.IsHitTestVisibleInChrome="True">
                        <TextBlock FontFamily="Segoe MDL2 Assets" FontSize="12" Text="&#xE8BB;" />
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0"
                    Width="{Binding SidebarWidth}"
                    MinWidth="0"
                    Background="{DynamicResource SidebarBackgroundBrush}"
                    BorderBrush="{DynamicResource BorderBrush}">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="BorderThickness" Value="0,0,1,0" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSidebarVisible}" Value="False">
                                <Setter Property="BorderThickness" Value="0" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <StackPanel Margin="20,16,20,12">
                        <TextBlock Text="Conversations" FontSize="14" FontWeight="SemiBold" />
                        <TextBlock Text="Folders and recent chats" FontSize="11" Foreground="{DynamicResource SecondaryTextBrush}" />
                    </StackPanel>

                    <TreeView x:Name="ConversationTree"
                              Grid.Row="1"
                              Margin="12,0,12,12"
                              Background="Transparent"
                              BorderThickness="0"
                              ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                              AllowDrop="True"
                              ItemsSource="{Binding ConversationItems}"
                              SelectedItemChanged="ConversationTree_SelectedItemChanged"
                              PreviewMouseLeftButtonDown="ConversationTree_PreviewMouseLeftButtonDown"
                              PreviewMouseMove="ConversationTree_PreviewMouseMove"
                              PreviewKeyDown="ConversationTree_PreviewKeyDown"
                              Drop="ConversationTree_Drop">
                        <TreeView.Resources>
                            <HierarchicalDataTemplate DataType="{x:Type vm:ChatFolderViewModel}" ItemsSource="{Binding Chats}">
                                <Grid Background="Transparent"
                                      HorizontalAlignment="Stretch">
                                    <Grid.ContextMenu>
                                        <ContextMenu Placement="MousePoint"
                                                     DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
                                            <MenuItem Header="Rename folder" Click="RenameFolder_Click" />
                                            <Separator />
                                            <MenuItem Header="Delete folder" Click="DeleteFolder_Click" />
                                        </ContextMenu>
                                    </Grid.ContextMenu>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <Path Width="16"
                                              Height="16"
                                              Stretch="Uniform"
                                              Margin="0,0,8,0"
                                              Data="M4 6 H9 L11 8 H20 V18 H4 Z"
                                              Stroke="{DynamicResource SecondaryTextBrush}"
                                              StrokeThickness="1.5"
                                              StrokeLineJoin="Round"
                                              StrokeStartLineCap="Round"
                                              StrokeEndLineCap="Round"
                                              Fill="Transparent" />
                                        <TextBlock Text="{Binding Name}"
                                                   Foreground="{DynamicResource PrimaryTextBrush}"
                                                   TextTrimming="CharacterEllipsis" />
                                    </StackPanel>
                                    <Border Grid.Column="1"
                                            Padding="6,2"
                                            CornerRadius="8"
                                            Background="{DynamicResource BadgeBackgroundBrush}"
                                            Margin="8,0,0,0"
                                            VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Chats.Count}"
                                                   FontSize="10"
                                                   Foreground="{DynamicResource SecondaryTextBrush}" />
                                    </Border>
                                </Grid>
                            </HierarchicalDataTemplate>

                            <DataTemplate DataType="{x:Type vm:ChatConversationViewModel}">
                                <Grid Background="Transparent"
                                      HorizontalAlignment="Stretch">
                                    <Grid.ContextMenu>
                                        <ContextMenu Placement="MousePoint"
                                                     DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
                                            <MenuItem Header="Convert to regular chat"
                                                      Click="ConvertTemporaryChat_Click"
                                                      Visibility="{Binding IsTemporary, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                            <MenuItem Header="Rename chat" Click="RenameChat_Click" />
                                            <MenuItem Header="Move to folder"
                                                      Tag="{Binding}"
                                                      StaysOpenOnClick="True"
                                                      Click="MoveToFolder_Open_Click"
                                                      SubmenuOpened="MoveToFolder_SubmenuOpened" />
                                            <Separator />
                                            <MenuItem Header="Delete chat" Click="DeleteChat_Click" />
                                        </ContextMenu>
                                    </Grid.ContextMenu>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8BD;" Margin="0,0,8,0" Foreground="{DynamicResource SecondaryTextBrush}" />
                                        <TextBlock Text="{Binding Title}"
                                                   Foreground="{DynamicResource PrimaryTextBrush}"
                                                   TextTrimming="CharacterEllipsis" />
                                    </StackPanel>
                                    <Border Grid.Column="1"
                                            Padding="6,2"
                                            CornerRadius="8"
                                            Background="{DynamicResource BadgeBackgroundBrush}"
                                            Margin="8,0,0,0"
                                            VerticalAlignment="Center"
                                            Visibility="{Binding IsTemporary, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <TextBlock Text="TEMP" FontSize="9" Foreground="{DynamicResource SecondaryTextBrush}" />
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </TreeView.Resources>

                        <TreeView.ItemContainerStyle>
                            <Style TargetType="TreeViewItem">
                                <Setter Property="Margin" Value="0,2" />
                                <Setter Property="Padding" Value="0" />
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}" />
                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="TreeViewItem">
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>
                                                <Border x:Name="HeaderBorder"
                                                        CornerRadius="10"
                                                        Background="{TemplateBinding Background}"
                                                        Padding="10,8">
                                                    <Grid>
                                                        <ContentPresenter ContentSource="Header" HorizontalAlignment="Stretch" />
                                                    </Grid>
                                                </Border>
                                                <Border x:Name="ItemsBorder"
                                                        Grid.Row="1"
                                                        Margin="26,4,0,0"
                                                        Opacity="0">
                                                    <Border.RenderTransform>
                                                        <TranslateTransform Y="-6" />
                                                    </Border.RenderTransform>
                                                    <ItemsPresenter x:Name="ItemsHost" />
                                                </Border>
                                            </Grid>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsExpanded" Value="False">
                                                    <Setter TargetName="ItemsHost" Property="Visibility" Value="Collapsed" />
                                                    <Setter TargetName="ItemsBorder" Property="Opacity" Value="0" />
                                                </Trigger>
                                                <Trigger Property="IsExpanded" Value="True">
                                                    <Setter TargetName="ItemsBorder" Property="Opacity" Value="1" />
                                                </Trigger>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="HeaderBorder" Property="Background" Value="{DynamicResource SelectionBackgroundBrush}" />
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="HeaderBorder" Property="Background" Value="{DynamicResource HoverBackgroundBrush}" />
                                                </Trigger>
                                                <EventTrigger RoutedEvent="Expanded">
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetName="ItemsBorder"
                                                                             Storyboard.TargetProperty="Opacity"
                                                                             From="0"
                                                                             To="1"
                                                                             Duration="0:0:0.2" />
                                                            <DoubleAnimation Storyboard.TargetName="ItemsBorder"
                                                                             Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                                             From="-6"
                                                                             To="0"
                                                                             Duration="0:0:0.2" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </EventTrigger>
                                                <EventTrigger RoutedEvent="Collapsed">
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetName="ItemsBorder"
                                                                             Storyboard.TargetProperty="Opacity"
                                                                             To="0"
                                                                             Duration="0:0:0.1" />
                                                            <DoubleAnimation Storyboard.TargetName="ItemsBorder"
                                                                             Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                                             To="-6"
                                                                             Duration="0:0:0.1" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </EventTrigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TreeView.ItemContainerStyle>
                    </TreeView>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="16,8,16,16">
                        <Button Content="New chat" Command="{Binding NewChatCommand}" MinWidth="110" IsEnabled="{Binding IsApiKeyAvailable}" />
                        <Button Content="New folder" Command="{Binding NewFolderCommand}" Margin="10,0,0,0" MinWidth="110"
                                Style="{StaticResource SecondaryButtonStyle}" />
                    </StackPanel>
                </Grid>
            </Border>

            <Grid Grid.Column="1" Background="{DynamicResource WindowBackgroundBrush}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Margin="20,16,20,8" Padding="16" Background="{DynamicResource PanelBackgroundBrush}" CornerRadius="12" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Setter Property="Opacity" Value="1" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsApiKeyMissing}" Value="True">
                                    <Setter Property="Opacity" Value="0.6" />
                                    <Setter Property="IsEnabled" Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <StackPanel>
                        <TextBlock Text="{Binding SelectedChat.Title}" FontSize="18" FontWeight="SemiBold" />
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <ComboBox Width="240"
                                      HorizontalAlignment="Left"
                                      HorizontalContentAlignment="Left"
                                      ItemsSource="{Binding AvailableModels}"
                                      SelectedItem="{Binding SelectedChat.SelectedModel, UpdateSourceTrigger=PropertyChanged}">
                                <ComboBox.Style>
                                    <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Type ComboBox}}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsApiKeyMissing}" Value="True">
                                                <Setter Property="IsEnabled" Value="False" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ComboBox.Style>
                            </ComboBox>
                            <ToggleButton x:Name="WebSearchToggle"
                                          Margin="10,0,0,0"
                                          Style="{StaticResource PillToggleButtonStyle}"
                                          ToolTip="Web search"
                                          IsEnabled="{Binding IsApiKeyAvailable}"
                                          IsChecked="{Binding SelectedChat.UseWebSearch, Mode=TwoWay}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE774;" FontSize="12" Margin="0,0,6,0" />
                                    <TextBlock Text="Web" FontSize="12" />
                                </StackPanel>
                            </ToggleButton>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <ScrollViewer x:Name="ChatScrollViewer"
                              Grid.Row="1"
                              Margin="20,0,20,8"
                              VerticalScrollBarVisibility="Auto">
                    <ScrollViewer.Style>
                        <Style TargetType="ScrollViewer">
                            <Setter Property="Opacity" Value="1" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsApiKeyMissing}" Value="True">
                                    <Setter Property="Opacity" Value="0.6" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ScrollViewer.Style>
                    <StackPanel>
                        <ItemsControl ItemsSource="{Binding ActiveMessages}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type models:ChatMessage}">
                                    <StackPanel Margin="0,6" HorizontalAlignment="{Binding Role, Converter={StaticResource MessageAlignmentConverter}}">
                                        <Border CornerRadius="14"
                                                Padding="10,8"
                                                MaxWidth="560">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="{DynamicResource AssistantBubbleBrush}" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Role}" Value="user">
                                                            <Setter Property="Background" Value="{DynamicResource UserBubbleBrush}" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <RichTextBox converters:MarkdownRichTextBox.Text="{Binding Content}"
                                                         IsReadOnly="True"
                                                         BorderThickness="0"
                                                         Background="Transparent"
                                                         Padding="0"
                                                         Margin="0"
                                                         MinHeight="0"
                                                         HorizontalScrollBarVisibility="Hidden"
                                                         VerticalScrollBarVisibility="Hidden"
                                                         Foreground="{DynamicResource PrimaryTextBrush}"
                                                         Cursor="IBeam" />
                                        </Border>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <Border x:Name="BusyIndicatorContainer"
                                Background="{DynamicResource AssistantBubbleBrush}"
                                CornerRadius="16"
                                Padding="10"
                                MaxWidth="120"
                                Margin="0,6,0,0"
                                HorizontalAlignment="Left"
                                Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <Ellipse x:Name="BusyIndicatorPulse"
                                     Width="10"
                                     Height="10"
                                     Fill="{DynamicResource SecondaryTextBrush}"
                                     RenderTransformOrigin="0.5,0.5">
                                <Ellipse.RenderTransform>
                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                </Ellipse.RenderTransform>
                                <Ellipse.Triggers>
                                    <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                                        <BeginStoryboard>
                                            <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                 From="0.4"
                                                                 To="1"
                                                                 Duration="0:0:0.6" />
                                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleX)"
                                                                 From="0.85"
                                                                 To="1.2"
                                                                 Duration="0:0:0.6" />
                                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleY)"
                                                                 From="0.85"
                                                                 To="1.2"
                                                                 Duration="0:0:0.6" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Ellipse.Triggers>
                            </Ellipse>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <Border Grid.Row="2" Margin="20,8,20,20" Background="{DynamicResource PanelBackgroundBrush}" CornerRadius="14" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Setter Property="Opacity" Value="1" />
                            <Setter Property="IsEnabled" Value="True" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsApiKeyMissing}" Value="True">
                                    <Setter Property="Opacity" Value="0.6" />
                                    <Setter Property="IsEnabled" Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <Grid Margin="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="InputBox"
                                 Text="{Binding InputText, UpdateSourceTrigger=PropertyChanged}"
                                 AcceptsReturn="True"
                                 MinHeight="56"
                                 VerticalScrollBarVisibility="Auto"
                                 TextWrapping="Wrap"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 PreviewKeyDown="InputBox_KeyDown" />
                        <Button Grid.Column="1"
                                Margin="10,0,2,0"
                                Style="{StaticResource SendButtonStyle}"
                                Command="{Binding SendMessageCommand}">
                            <TextBlock FontFamily="Segoe MDL2 Assets" FontSize="16" Text="&#xE72A;" />
                        </Button>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>
